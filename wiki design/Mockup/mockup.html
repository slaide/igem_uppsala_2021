<!doctype html>
<html>
    <head>
        <meta charset="utf8">
        <script src="https://cdn.jsdelivr.net/npm/warpjs@1.0.8/dist/warp.js"></script>
        <script src="svg_landing_page_images.js"></script>
        <link rel="stylesheet" href="main.css">
        <link rel="stylesheet" href="main_1.css">
        <link rel="stylesheet" href="main_2.css">
        <link rel="stylesheet" href="mockup.css">
    </head>
    <body>
        <main>
            <div class="panel">
                <img class="reference_image" src="IMG_0968.PNG"/>
                <div class="real">
                    <div id="grass_front"></div>
                    <div id="grass_front_middle_fill"></div>
                    <div id="cow_left"></div>
                    <div id="grass_middle"></div>
                    <div id="grass_middle_back_fill"></div>
                    <div id="cow_right"></div>
                    <div id="grass_back"></div>
                    <div id="mountain_back"></div>
                    <div id="mountain_middle"></div>
                    <div id="mountain_front"></div>
                </div>
            </div>
            <div class="panel">
                <img class="reference_image" src="IMG_0969.PNG"/>
                <div class="real" style="oopacity:0.5;">
                    <div id="steak_big"></div>

                    <div id="co2_text" class="text_top_left">CO2 emissions</div>
                    <div id="co_bubble_container">
                        <div class="co_bubble">
                            <img class="co_bubble_text" src='../2-meat-problems/co2_font.svg'>
                        </div>
                        <div class="co_bubble">
                            <img class="co_bubble_text" src='../2-meat-problems/co4_font.svg'>
                        </div>
                        <div class="co_bubble">
                            <img class="co_bubble_text" src='../2-meat-problems/co2_font.svg'>
                        </div>
                        <div class="co_bubble">
                            <img class="co_bubble_text" src='../2-meat-problems/co2_font.svg'>
                        </div>
                    </div>

                    <div id="deforestation_text" class="text_bottom_left">Deforestation</div>

                    <div id="antibiotic_text" class="text_top_right">Antibiotic resistance</div>
                    <div id="syringe_container">
                        <div id="antibiotic_syringe_body"></div>
                        <div id="antibiotic_syringe_top"></div>
                        <div id="antibiotic_syringe_fluid"></div>
                    </div>

                    <div id="factory_text" class="text_bottom_right">Factory Farming</div>
                </div>
            </div>
            <div class="panel">
                <img class="reference_image" src="IMG_0970.PNG"/>
            </div>
            <div class="panel">
                <img class="reference_image" src="IMG_0971.PNG"/>
            </div>
            <div class="panel">
                <img class="reference_image" src="IMG_0972.PNG"/>
            </div>
        </main>
        <script>
            let disable_complex_animations=true
            const cap_framerate=30

            if(!grass_front_svg){
                window.alert("front grass is missing")
            }
            let grass_front=document.getElementById('grass_front')
            grass_front.innerHTML=grass_front_svg

            const warp_front = new Warp(grass_front.children[0])
            let offset_front = 0
            const offset_front_delta=1.25/cap_framerate
            const amplitude=0.15
            const phase_multiplier=0.035
            function animate_front_grass(){
                warp_front.transform(([ x, y ]) => [ x+amplitude*Math.sin(phase_multiplier*y+offset_front), y])
                offset_front += offset_front_delta
            }
            //animate once to set positions
            animate_front_grass()
            setInterval(()=>disable_complex_animations?()=>{}:requestAnimationFrame(animate_front_grass),1000/cap_framerate)

            let co_container=document.getElementById("co_bubble_container")

            let path=document.createElementNS("http://www.w3.org/2000/svg","path")
            path.setAttribute("d","M342.18,931C286.5,916.5,210.5,861.5,229.5,786.5c22.35-88.21,147.26-65.91,161-125,10-43-34-87-44-111")

            let offset_delta=0.004

            let offsets=[0.0,1/4,2/4,3/4]
            let offset_deltas=[offset_delta,offset_delta,offset_delta,offset_delta]
            let cos=[2,4,2,4]
            function min(a,b){return (a<b)?a:b}
            function max(a,b){return (a>b)?a:b}
            for (i=0;i<offsets.length;i++){
                offsets[i]+=0.2
                if(cos[i]==2){
                    co_container.children[i].style.setProperty("background-image","url('../2-meat-problems/co2_no_font.svg')")
                    co_container.children[i].innerHTML='<img class="co_bubble_text" src="../2-meat-problems/co2_font.svg">'
                }else{
                    co_container.children[i].style.setProperty("background-image","url('../2-meat-problems/co4_no_font.svg')")
                    co_container.children[i].innerHTML='<img class="co_bubble_text" src="../2-meat-problems/co4_font.svg">'
                }
            }

            function animate_co_bubbles(){
                for (i=0;i<offsets.length;i++){
                    const offset=offsets[i]

                    const position=path.getPointAtLength(path.getTotalLength()*offset)

                    offsets[i]+=offset_deltas[i]

                    if(offset>1){
                        offsets[i]=0
                    }

                    position.x-=166+50;
                    position.y-=381+270;

                    co_container.children[i].style.top=position.y*1.1+"px"
                    co_container.children[i].style.left=position.x+"px"

                    const scale=Math.sin(offset*(1-offset)*3.14)*1.4
                    co_container.children[i].style.transform="scale("+scale*scale+")"

                    if (offset>0.2 && offset<0.8){
                        co_container.children[i].children[0].style.setProperty("opacity",1)
                    }else{
                        co_container.children[i].children[0].style.setProperty("opacity",0)
                    }
                }
            }
            //animate once to set positions
            animate_co_bubbles()
            setInterval(()=>disable_complex_animations?()=>{}:requestAnimationFrame(animate_co_bubbles),1000/cap_framerate)
        </script>
    </body>
</html>